<template>
  <div class="layout slds-var-p-around_medium">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center slds-m-bottom_small">
        <h2 class="slds-text-heading_small">Reports</h2>
        <lightning-badge label={reportCount}></lightning-badge>
      </div>

      <lightning-input
        type="search"
        variant="label-hidden"
        placeholder="Search report"
        class="slds-m-bottom_small"
        value={searchTerm}
        onchange={handleSearchChange}>
      </lightning-input>

      <lightning-vertical-navigation
        class="nav"
        selected-item={selectedName}
        onselect={handleSelect}>
        <template for:each={filteredNames} for:item="name">
          <lightning-vertical-navigation-item
            key={name}
            name={name}
            label={name}>
          </lightning-vertical-navigation-item>
        </template>
      </lightning-vertical-navigation>
    </aside>

    <!-- Viewer -->
    <section class="viewer">
      <template if:true={isLoading}>
        <lightning-spinner alternative-text="Carregando..." size="small"></lightning-spinner>
      </template>

      <template if:true={selectedName}>
        <article class="slds-card viewer-card">
          <div class="slds-card__header slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
            <div class="slds-media">
              <div class="slds-media__figure slds-m-right_small">
                <lightning-icon icon-name="doctype:report" size="small"></lightning-icon>
              </div>
              <div class="slds-media__body">
                <h3 class="slds-text-heading_small">{selectedName}</h3>
              </div>
            </div>
            <div class="viewer-actions slds-button-group" role="group">
              <lightning-button-icon style="padding-right: 5px;"
                icon-name="utility:refresh"
                alternative-text="Reload"
                onclick={reload}>
              </lightning-button-icon>
              <template if:true={computedSrc}>
                <lightning-button-icon
                  icon-name="utility:new_window"
                  alternative-text="Open in new tab"
                  onclick={openInNewTab}>
                </lightning-button-icon>
              </template>
            </div>
          </div>

          <div class="slds-card__body slds-p-around_none">
            <div style="width:100%; height:100%; display:flex; justify-content:center;">
              <iframe
                key={iframeKey}
                title={selectedName}
                width="1140"
                height="541.25"
                src={computedSrc}
                frameborder="0"
                allowfullscreen>
              </iframe>
            </div>
          </div>
        </article>
      </template>

      <template if:false={selectedName}>
        <div class="empty-state slds-align_absolute-center slds-text-align_center">
          <lightning-icon icon-name="utility:trail" size="large"></lightning-icon>
          <h3 class="slds-text-heading_small slds-m-top_small">Select a report</h3>
        </div>
      </template>
    </section>
  </div>
</template>